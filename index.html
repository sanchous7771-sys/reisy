<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–£—á—ë—Ç —Ä–µ–π—Å–æ–≤ –ü–ì–°</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; background: #f0f2f5; }
h1 { text-align: center; margin-bottom: 20px; }
.panel { display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 20px; }
.panel div { background: linear-gradient(135deg,#fff,#e3f2fd); padding: 15px; border-radius: 12px; flex: 1 1 200px; min-width: 180px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); cursor: pointer; }
.panel div span { font-weight: bold; display: block; margin-top: 5px; }
button { padding: 10px 15px; margin: 5px; border: none; border-radius: 6px; cursor: pointer; }
.btn { background: #4CAF50; color: white; }
.btn-red { background: #f44336; color: white; }
.btn-blue { background: #2196F3; color: white; }
.form-group { display: none; margin-top: 10px; background: white; padding: 15px; border-radius: 10px; box-shadow: 0 3px 8px rgba(0,0,0,0.1); }
.form-group input, .form-group select { padding: 5px; margin-right: 5px; border-radius: 4px; border: 1px solid #ccc; }
#savedZonesList { margin-top: 10px; max-height: 200px; overflow-y: auto; background: #fff; border-radius: 8px; padding: 5px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);}
#savedZonesList div { display: flex; justify-content: space-between; align-items: center; padding: 5px 10px; border-bottom: 1px solid #ddd; }
#savedZonesList div:last-child { border-bottom: none; }
#notify { padding: 8px; margin-top: 10px; border-radius: 5px; display: none; background: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
</style>
</head>
<body>

<h1>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —É—á—ë—Ç —Ä–µ–π—Å–æ–≤ –ü–ì–°</h1>

<div class="panel">
    <div id="unloadZone">–ó–æ–Ω–∞ –≤—ã–≥—Ä—É–∑–∫–∏: <span>–Ω–µ –∑–∞–¥–∞–Ω–æ</span></div>
    <div id="excZone">–≠–∫—Å–∫–∞–≤–∞—Ç–æ—Ä: <span>–Ω–µ –∑–∞–¥–∞–Ω–æ</span></div>
    <div id="coords">–¢–µ–∫—É—â–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: <span>–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö</span></div>
    <div>–°—Ç–∞—Ç—É—Å: <span id="status">–û–∂–∏–¥–∞–Ω–∏–µ...</span></div>
    <div>–°—á—ë—Ç—á–∏–∫ —Ä–µ–π—Å–æ–≤: <span id="counter">0</span></div>
    <div>–û–±—â–∏–π –∫–∏–ª–æ–º–µ—Ç—Ä–∞–∂: <span id="kmTotal">0</span> –∫–º</div>
</div>

<button class="btn" onclick="toggleForm()">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–æ–Ω</button>

<div class="form-group" id="zoneForm">
    <h3>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Ç–æ—á–∫—É</h3>
    <input type="text" id="zoneName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ—á–∫–∏">
    <input type="number" id="zoneLat" placeholder="–®–∏—Ä–æ—Ç–∞">
    <input type="number" id="zoneLon" placeholder="–î–æ–ª–≥–æ—Ç–∞">
    <button class="btn" onclick="saveZone()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ—á–∫—É</button>

    <h3>–°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ —Ç–æ—á–∫–∏</h3>
    <div id="savedZonesList"></div>
</div>

<div id="notify"></div>

<script>
let data = {
    unloadZone: null,
    excZone: null,
    savedZones: [
        {name: "—É–≥–æ–ª –≤–æ–∑–ª–µ –ø–æ–¥—ä–µ–º–∞", lat: 56.081522, lon: 93.201198},
        {name: "–û—Ç–≤–∞–ª –æ—Å–Ω–æ–≤–Ω–æ–π", lat: 56.081019, lon: 93.187775}
    ]
};

// ---------- –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ ----------
function saveData(){localStorage.setItem('pgsData', JSON.stringify(data));}
function loadData(){const s=localStorage.getItem('pgsData'); if(s){data = JSON.parse(s);} updateSavedZonesList(); updateZonesUI();}

// ---------- —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è ----------
function notify(msg){const n=document.getElementById('notify'); n.innerText=msg; n.style.display='block'; setTimeout(()=>n.style.display='none', 3000);}

// ---------- —Ñ–æ—Ä–º—ã ----------
function toggleForm(){const f=document.getElementById('zoneForm'); f.style.display = f.style.display==='none'?'block':'none';}

// ---------- —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ—á–∫–∏ ----------
function saveZone(){
    const name = document.getElementById('zoneName').value;
    const lat = parseFloat(document.getElementById('zoneLat').value);
    const lon = parseFloat(document.getElementById('zoneLon').value);
    if(!name || isNaN(lat) || isNaN(lon)){ notify('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ'); return; }
    data.savedZones.push({name, lat, lon});
    document.getElementById('zoneName').value=''; document.getElementById('zoneLat').value=''; document.getElementById('zoneLon').value='';
    updateSavedZonesList(); saveData();
    notify(`–¢–æ—á–∫–∞ "${name}" —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞`);
}

// ---------- —Å–ø–∏—Å–æ–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Ç–æ—á–µ–∫ ----------
function updateSavedZonesList(){
    const list = document.getElementById('savedZonesList'); list.innerHTML='';
    data.savedZones.forEach((z,i)=>{
        const div = document.createElement('div');
        div.innerHTML = `<span>${z.name} (${z.lat.toFixed(6)}, ${z.lon.toFixed(6)})</span>
            <span>
                <button onclick="editZone(${i})">‚úèÔ∏è</button>
                <button onclick="deleteZone(${i})">üóëÔ∏è</button>
                <button onclick="setZone('unload',${i})">üìç–í—ã–≥—Ä—É–∑–∫–∞</button>
                <button onclick="setZone('exc',${i})">üìç–≠–∫—Å–∫–∞–≤–∞—Ç–æ—Ä</button>
            </span>`;
        list.appendChild(div);
    });
}

// ---------- —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ—á–∫–∏ ----------
function editZone(index){
    const z = data.savedZones[index];
    const name = prompt('–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ—á–∫–∏:', z.name);
    if(name===null) return;
    const lat = parseFloat(prompt('–®–∏—Ä–æ—Ç–∞:', z.lat));
    const lon = parseFloat(prompt('–î–æ–ª–≥–æ—Ç–∞:', z.lon));
    if(isNaN(lat)||isNaN(lon)){ notify('–ù–µ–≤–µ—Ä–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã'); return; }
    z.name=name; z.lat=lat; z.lon=lon;
    updateSavedZonesList(); saveData();
    notify(`–¢–æ—á–∫–∞ "${name}" –æ–±–Ω–æ–≤–ª–µ–Ω–∞`);
}

// ---------- —É–¥–∞–ª–µ–Ω–∏–µ —Ç–æ—á–∫–∏ ----------
function deleteZone(index){
    if(confirm(`–£–¥–∞–ª–∏—Ç—å —Ç–æ—á–∫—É "${data.savedZones[index].name}"?`)){
        data.savedZones.splice(index,1);
        updateSavedZonesList(); saveData();
        notify('–¢–æ—á–∫–∞ —É–¥–∞–ª–µ–Ω–∞');
    }
}

// ---------- –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∑–æ–Ω—ã ----------
function setZone(type,index){
    const z = data.savedZones[index];
    if(type==='unload'){data.unloadZone=z; notify(`–ó–æ–Ω–∞ –≤—ã–≥—Ä—É–∑–∫–∏: ${z.name}`);}
    else{data.excZone=z; notify(`–≠–∫—Å–∫–∞–≤–∞—Ç–æ—Ä: ${z.name}`);}
    updateZonesUI(); saveData();
}

// ---------- –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –∑–æ–Ω ----------
function updateZonesUI(){
    document.getElementById('unloadZone').querySelector('span').innerText = data.unloadZone? `${data.unloadZone.lat.toFixed(6)}, ${data.unloadZone.lon.toFixed(6)}`:'–Ω–µ –∑–∞–¥–∞–Ω–æ';
    document.getElementById('excZone').querySelector('span').innerText = data.excZone? `${data.excZone.lat.toFixed(6)}, ${data.excZone.lon.toFixed(6)}`:'–Ω–µ –∑–∞–¥–∞–Ω–æ';
}

// ---------- –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç ----------
function startTracking(){
    if(!navigator.geolocation) { notify('GPS –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è'); return; }
    navigator.geolocation.watchPosition(pos=>{
        const lat = pos.coords.latitude, lon = pos.coords.longitude;
        document.getElementById('coords').querySelector('span').innerText = `${lat.toFixed(6)}, ${lon.toFixed(6)}`;
    }, err=>console.log(err), { enableHighAccuracy:true, maximumAge:1000 });
}

// ---------- –∫–ª–∏–∫ –ø–æ —Ç–µ–∫—É—â–∏–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è ----------
document.getElementById('coords').addEventListener('click', ()=>{
    const text = document.getElementById('coords').querySelector('span').innerText;
    if(!text || text==='–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö') return;
    const [lat, lon] = text.split(',').map(Number);
    const name = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è —ç—Ç–æ–π —Ç–æ—á–∫–∏');
    if(name && !isNaN(lat) && !isNaN(lon)){
        data.savedZones.push({name, lat, lon});
        updateSavedZonesList(); saveData();
        notify(`–¢–æ—á–∫–∞ "${name}" —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞`);
    }
});

loadData(); startTracking();
</script>

</body>
</html>








