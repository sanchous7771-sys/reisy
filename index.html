<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£—á—ë—Ç —Ä–µ–π—Å–æ–≤ –ü–ì–°</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f4f4f4; }
        h1 { color: #333; }
        button { padding: 10px 15px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
        #coords { margin-top: 10px; font-size: 14px; color: #555; }
        .btn { background: #4CAF50; color: white; }
        .btn-red { background: #f44336; color: white; }
        .btn-blue { background: #2196F3; color: white; }
        .btn-orange { background: #FF9800; color: white; }
    </style>
</head>
<body>
    <h1>–£—á—ë—Ç —Ä–µ–π—Å–æ–≤ –ü–ì–° (—Ç–µ—Å—Ç–æ–≤–∞—è –≤–µ—Ä—Å–∏—è)</h1>

    <p>–§–∞–±—Ä–∏–∫–∞: <span id="fabCoords">–Ω–µ –∑–∞–¥–∞–Ω–æ</span></p>
    <p>–¢–µ–∫—É—â–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: <span id="coords">–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö</span></p>
    <p>–°—á—ë—Ç—á–∏–∫ —Ä–µ–π—Å–æ–≤: <span id="counter">0</span></p>

    <button class="btn" onclick="setFactory()">üìç –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–∞–±—Ä–∏–∫—É</button>
    <button class="btn" onclick="startTrip()">‚ûï –ù–∞—á–∞—Ç—å —Ä–µ–π—Å</button>
    <button class="btn-red" onclick="resetCounter()">‚ôªÔ∏è –°–±—Ä–æ—Å–∏—Ç—å</button>
    <button class="btn-blue" onclick="downloadData()">‚¨áÔ∏è –í—ã–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
    <button class="btn-orange" onclick="resetCoords()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã</button>

    <script>
        let factory = null;
        let trips = 0;
        let tripData = [];
        let currentTrip = null;

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
        setInterval(getLocation, 5000);

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(pos => {
                    let lat = pos.coords.latitude.toFixed(6);
                    let lon = pos.coords.longitude.toFixed(6);
                    document.getElementById('coords').innerText = `${lat}, ${lon}`;

                    // –ï—Å–ª–∏ —Ä–µ–π—Å –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ, –æ–±–Ω–æ–≤–ª—è–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
                    if (currentTrip) {
                        currentTrip.endCoords = { lat: lat, lon: lon };
                    }
                }, err => {
                    alert("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ. –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.");
                });
            }
        }

        function setFactory() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(pos => {
                    factory = {
                        lat: pos.coords.latitude,
                        lon: pos.coords.longitude
                    };
                    document.getElementById('fabCoords').innerText = `${factory.lat.toFixed(6)}, ${factory.lon.toFixed(6)}`;
                    alert("–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ñ–∞–±—Ä–∏–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!");
                });
            }
        }

        function startTrip() {
            if (!currentTrip) {
                currentTrip = {
                    startTime: new Date(),
                    startCoords: {
                        lat: document.getElementById('coords').innerText.split(',')[0],
                        lon: document.getElementById('coords').innerText.split(',')[1]
                    },
                    endCoords: null
                };
                trips++;
                document.getElementById('counter').innerText = trips;
                alert("–†–µ–π—Å –Ω–∞—á–∞—Ç!");
            } else {
                alert("–†–µ–π—Å —É–∂–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ! –°–Ω–∞—á–∞–ª–∞ –∑–∞–≤–µ—Ä—à–∏—Ç–µ –µ–≥–æ.");
            }
        }

        function endTrip() {
            if (currentTrip) {
                currentTrip.endTime = new Date();
                tripData.push(currentTrip);
                currentTrip = null;
                alert("–†–µ–π—Å –∑–∞–≤–µ—Ä—à—ë–Ω!");
            } else {
                alert("–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–µ–π—Å–∞ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.");
            }
        }

        function resetCounter() {
            trips = 0;
            tripData = [];
            currentTrip = null;
            document.getElementById('counter').innerText = trips;
            alert("–°—á—ë—Ç—á–∏–∫ –∏ –¥–∞–Ω–Ω—ã–µ —Ä–µ–π—Å–æ–≤ —Å–±—Ä–æ—à–µ–Ω—ã!");
        }

        function resetCoords() {
            document.getElementById('coords').innerText = '–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
            if (currentTrip) {
                currentTrip.endCoords = null;
            }
            alert("–¢–µ–∫—É—â–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Å–±—Ä–æ—à–µ–Ω—ã!");
        }

        function downloadData() {
            const dataStr = JSON.stringify(tripData, null, 2);
            const blob = new Blob([dataStr], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'trips_data.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        getLocation();
    </script>
</body>
</html>
