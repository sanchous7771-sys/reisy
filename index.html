<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —É—á—ë—Ç —Ä–µ–π—Å–æ–≤ –ü–ì–°</title>
<style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f4f4f4; }
    h1 { color: #333; }
    button { padding: 10px 15px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
    .btn { background: #4CAF50; color: white; }
    .btn-red { background: #f44336; color: white; }
    .btn-blue { background: #2196F3; color: white; }
    #coords { font-size: 14px; color: #555; }
    #notify { padding: 8px; background: #eee; margin-top: 10px; border-radius: 5px; display: none; }
    ul { padding-left: 20px; }
</style>
</head>
<body>
<h1>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —É—á—ë—Ç —Ä–µ–π—Å–æ–≤ –ü–ì–°</h1>

<p>–§–∞–±—Ä–∏–∫–∞: <span id="fabCoords">–Ω–µ –∑–∞–¥–∞–Ω–æ</span></p>
<p>–≠–∫—Å–∫–∞–≤–∞—Ç–æ—Ä: <span id="excCoords">–Ω–µ –∑–∞–¥–∞–Ω–æ</span></p>
<p>–¢–µ–∫—É—â–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: <span id="coords">–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö</span></p>
<p>–°—Ç–∞—Ç—É—Å: <span id="status">–û–∂–∏–¥–∞–Ω–∏–µ...</span></p>
<p>–°—á—ë—Ç—á–∏–∫ —Ä–µ–π—Å–æ–≤: <span id="counter">0</span></p>

<button class="btn" onclick="setFactory()">üìç –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–∞–±—Ä–∏–∫—É</button>
<button class="btn" onclick="setExcavator()">üìç –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä</button>
<button class="btn-red" onclick="resetData()">‚ôªÔ∏è –°–±—Ä–æ—Å–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
<button class="btn-blue" onclick="downloadData()">‚¨áÔ∏è –í—ã–≥—Ä—É–∑–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é</button>

<div id="notify"></div>

<h3>–ò—Å—Ç–æ—Ä–∏—è —Ä–µ–π—Å–æ–≤:</h3>
<ul id="tripList"></ul>

<script>
let data = {
    factory: null,
    excavator: null,
    trips: 0,
    tripData: [],
    lastPoint: null,
    enRoute: false // —Ñ–ª–∞–≥ "–≤ –ø—É—Ç–∏"
};

function saveData() {
    localStorage.setItem('pgsData', JSON.stringify(data));
}
function loadData() {
    const saved = localStorage.getItem('pgsData');
    if (saved) {
        data = JSON.parse(saved);
        updateUI();
    }
}

function notify(msg) {
    const n = document.getElementById('notify');
    n.innerText = msg;
    n.style.display = 'block';
    setTimeout(() => n.style.display = 'none', 3000);
}

function updateUI() {
    document.getElementById('counter').innerText = data.trips;
    if (data.factory) {
        document.getElementById('fabCoords').innerText = `${data.factory.lat.toFixed(6)}, ${data.factory.lon.toFixed(6)}`;
    }
    if (data.excavator) {
        document.getElementById('excCoords').innerText = `${data.excavator.lat.toFixed(6)}, ${data.excavator.lon.toFixed(6)}`;
    }
    renderTripLi
